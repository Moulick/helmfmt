Парсинг кода:

1. Критерий открытия комментария:

- `{{/*`
- `{{- /*`

2. Критерий закрытия комментария:

- `*/}}` или `*/ -}}` в той же или в одной из последующих строк.

3. Критерий открытия обьявления переменной:

- `{{`(0 or more spaces) `$var`
- `{{-`(1 or more spaces) `$var`

4. Критерий закрытия объявления переменной:

- `-}}` или `}}` в той же или в одной из последующих строк.

5. Критерий открытия include/fail/toYaml/printf etc.:

- `{{`(0 or more spaces) `include/fail/toYaml/printf etc.`
- `{{-`(1 or more spaces) `include/fail/toYaml/printf etc.`

6. Критерий закрытия include/fail/toYaml/printf etc.:

- `-}}` или `}}` в той же или в одной из последующих строк.

7. Критерий открытия начала управляющей конструкции:

- `{{`(0 or more spaces) control
- `{{-`(1 or more spaces) control

8. Критерий закрытия начала управляющей конструкции:

- `-}}` или `}}` в той же или в одной из последующих строк.

9. Критерий открытия конца управляющей конструкции:

- `{{`(0 or more spaces) end
- `{{-`(1 or more spaces) end

10. Критерий закрытия конца управляющей конструкции:

- `-}}` или `}}` в той же или в одной из последующих строк.

Сценарии:

- линия начинается с открытия начала управляющей конструкции.
- линия начинается с комментария, а открытие начала управляющей конструкции начинается после закрытия комментария в этой же или следующей строке.
- линия начинается с закрытия конца управляющей конструкции.
- линия начинается с комментария, а закрытие конца управляющей конструкции начинается после закрытия комментария в этой же или следующей строке.
- линия начинается с открытия объявления переменной.
- линия начинается с комментария, а открытие начала объявления переменной начинается после закрытия комментария в этой же или следующей строке.

Требования:

- у управляющей конструкции должен быть отступ относительно другой управляющей конструкции
- у объявления переменной или комментария должен быть отступ относительно управляющей конструкции, внури которой находится объявление переменной или комментарий
- у инструкций include, printf и т. п., тоже должен быть отступ

Исключения:

- если управляющая конструкция содержит конец в той же строке, где её начало, то у таких строк не должен прибавляться отступ, т. е. он должен быть таким же, как у переменных
- нужно иметь в виду, что между началом и концом управляющей конструкции может быть комментарий
