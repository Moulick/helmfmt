Парсинг кода:

1. Критерий открытия комментария:

- `{{`(0 spaces/newlines/tabs)`/*`
- `{{-`(exactly 1 spaces/newlines/tabs)`/*`

2. Критерий закрытия комментария:

- `*/`(0 spaces)`}}` или `*/`(exactly 1 spaces/newlines/tabs)`-}}` в той же или в одной из последующих строк.

3. Критерий открытия обьявления переменной, а также открытия include/fail/printf etc.:

- `{{`(0 or more spaces)`$var/include/fail/printf etc.`
- `{{-`(1 or more spaces/newlines/tabs)`$var`

4. Критерий закрытия обьявления переменной, а также открытия include/fail/printf etc.:

- (1 or more spaces/newlines/tabs)`-}}` или (0 or more spaces)`}}` в той же или в одной из последующих строк.

5. Критерий открытия начала управляющей конструкции:

- `{{`(0 or more spaces) control
- `{{-`(1 or more spaces/newlines/tabs) control

6. Критерий закрытия начала управляющей конструкции:

- (1 or more spaces/newlines/tabs)`-}}` или (0 or more spaces)`}}` в той же или в одной из последующих строк.

7. Критерий открытия конца управляющей конструкции:

- `{{`(0 or more spaces) end
- `{{-`(1 or more spaces/newlines/tabs) end

8. Критерий закрытия конца управляющей конструкции:

- (1 or more spaces/newlines/tabs)`-}}` или (0 or more spaces)`}}` в той же или в одной из последующих строк.

Сценарии:

- линия начинается с открытия начала управляющей конструкции.
- линия начинается с комментария, а открытие начала управляющей конструкции начинается после закрытия комментария в этой же или следующей строке.
- линия начинается с закрытия конца управляющей конструкции.
- линия начинается с комментария, а закрытие конца управляющей конструкции начинается после закрытия комментария в этой же или следующей строке.
- линия начинается с открытия объявления переменной.
- линия начинается с комментария, а открытие начала объявления переменной начинается после закрытия комментария в этой же или следующей строке.

Требования:

- у управляющей конструкции должен быть отступ относительно другой управляющей конструкции
- у объявления переменной или комментария должен быть отступ относительно управляющей конструкции, внури которой находится объявление переменной или комментарий
- у инструкций include, printf и т. п., тоже должен быть отступ

Исключения:

- если управляющая конструкция содержит конец в той же строке, где её начало, то у таких строк не должен прибавляться отступ, т. е. он должен быть таким же, как у переменных
- нужно иметь в виду, что между началом и концом управляющей конструкции может быть комментарий
